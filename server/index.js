const { ApiError } = require('./errors')
const { authRouter, userRouter } = require('./routers')
const bodyParser = require('body-parser')
const errorHandler = require('./helpers/error-handler')
const express = require('express')
const helmet = require('helmet')
const httpStatus = require('http-status')
const morgan = require('morgan')

module.exports = express()
  .use(morgan(process.env.NODE_ENV === 'production' ? 'combined' : 'dev'))
  .use(helmet())
  .use(bodyParser.json({ type: 'application/json' }))
  .use('/auth', authRouter)
  .use('/users', userRouter)
  .use((req, res, next) =>
    next(new ApiError('Invalid request', httpStatus.BAD_REQUEST, true)))
  .use(errorHandler)
